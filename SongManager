package exceptions;

public class EmailFormatException extends Exception {

}

package github;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.InputMismatchException;
import java.util.Scanner;
import log.EventLogger;

public class MenuManager {
	
	static EventLogger logger = new EventLogger("log.txt");
	
	public static void main(String[] args) {
		
		Scanner input = new Scanner(System.in);
		SongManager songManager = getObject("songmanager.ser");
		if (songManager == null) {
			songManager = new SongManager(input);
		}
		else {
			songManager.setScanner(input);
		}
		selectMenu(input, songManager );
		putObject(songManager, "songmanager.ser");
	}

	public static void selectMenu(Scanner input, SongManager songManager) {
		int num = -1;
		while(num !=5) {
			try {
				showMenu();
				num = input.nextInt();
				switch(num) {
				case 1:
					songManager.addsong();
					logger.log("add a song");
					break;
				case 2:
					songManager.deletesong();
					logger.log("delete a song");
					break;
				case 3:
					songManager.editsong();
					logger.log("edit a song");
					break;
				case 4:
					songManager.viewsongs();
					logger.log("view a list of songs");
					break;
				default:
					continue;
				}
			}
			catch(InputMismatchException e) {
				System.out.println("please put an integer between 1 and 5!");
				if(input.hasNext()) {
					input.next();
				}
				num = -1;
			}
		}
	}
	public static void showMenu() {
		System.out.println("*** Song Management System meny ***");
		System.out.println("  1. Add Song");
		System.out.println("  2. Delete Song");
		System.out.println("  3. Edit Song");
		System.out.println("  4. View Song");
		System.out.println("  5. Exit");
		System.out.println("Select one number between 1 - 5:");
	}
	public static SongManager getObject(String filename) {
		SongManager songManager = null;
		try {
			FileInputStream file = new FileInputStream(filename);
			ObjectInputStream in = new ObjectInputStream(file);
			songManager = (SongManager) in.readObject();
			in.close();
			file.close();
		} catch (FileNotFoundException e) {
			return songManager;
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return songManager;
	}
	public static void putObject(SongManager songManager, String filename) {

		try {
			FileOutputStream file = new FileOutputStream(filename);
			ObjectOutputStream out = new ObjectOutputStream(file);
			out.writeObject(songManager);
			out.close();
			file.close();
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}

package github;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.InputMismatchException;
import java.util.Scanner;

import song.ElementarySchoolSong;
import song.HighSchoolSong;
import song.SongInput;
import song.SongKind;
import song.UniversitySong;

public class SongManager implements Serializable{
	/**
	 * 
	 */
	private static final long serialVersionUID = -2684755737374697795L;
	ArrayList<SongInput> songs = new ArrayList<SongInput>();
	transient Scanner input;
	SongManager(Scanner input){
		this.input = input;
	}
	
	public void setScanner(Scanner input) {
		this.input = input;
	}
	
	public void addsong() {
		int kind = 0;
		SongInput songInput;
		while(kind < 1 || kind > 3) {
			try {
				System.out.println("1 for University");
				System.out.println("2 for High School");
				System.out.println("3 for Elementary School");
				System.out.println("Select num 1, 2, or 3 for Song Kind : ");
				kind = input.nextInt();
				if (kind == 1) {
					songInput =new UniversitySong(SongKind.University);
					songInput.getUserInput(input);
					songs.add(songInput);
					break;
				}
				else if (kind ==2) {
					songInput =new HighSchoolSong(SongKind.HighSchool);
					songInput.getUserInput(input);
					songs.add(songInput);
					break;

				}
				else if (kind ==3) {
					songInput =new ElementarySchoolSong(SongKind.ElementarySchool);
					songInput.getUserInput(input);
					songs.add(songInput);
					break;

				}
				else {
					System.out.print("Select num for Song Kind between 1 and 2:");
				}
			}
			catch(InputMismatchException e) {
				System.out.println("please put an integer between 1 and 3!");
				if(input.hasNext()) {
					input.next();
				}
				kind = -1;
			}
		}
	}

	public void deletesong() {
		System.out.print("song ID:");
		int songId = input.nextInt();
		int index = findIndex(songId);
		removefromSongs(index, songId);
	}
	public int findIndex(int songId) {
		int index = -1;
		for (int i = 0; i<songs.size(); i++) {
			if (songs.get(i).getId() == songId) {
				index = i;
				break;
			}
		}
		return index;
	}
	public int removefromSongs(int index, int songId) {
		if(index >= 0) {
			songs.remove(index);
			System.out.println("the song" + songId +" is deleted");
			return 1;
		}
		else {
			System.out.println("the song has not been registered");
			return -1;
		}
	}
	public void editsong() {
		System.out.print("song ID:");
		int songId = input.nextInt();
		for (int i = 0; i<songs.size(); i++) {
			SongInput song = songs.get(i);
			if (song.getId() == songId) {
				int num = -1;
				while(num !=5) {
					showEditMenu();
					num = input.nextInt();
					switch(num) {
					case 1:
						song.setSongID(input);
						break;
					case 2:
						song.setSongName(input);
						break;
					case 3:
						song.setSongEmail(input);
						break;
					case 4:
						song.setSongPhone(input);
						break;
					default:
						continue;
					}
				}//while
				break;
			}//if
		}//for
	}
	public void viewsongs() {
		System.out.println("# of registerd songs:"+ songs.size());
		for (int i = 0; i<songs.size(); i++) {
			songs.get(i).printInfo();
		}
	}


	public void showEditMenu() {
		System.out.println("** song Info Edit Menu **");
		System.out.println("  1. Edit Id");
		System.out.println("  2. Edit Name");
		System.out.println("  3. Edit Email");
		System.out.println("  4. Edit Phone");
		System.out.println("  5. Exit");
		System.out.println("Select one number between 1 - 5:");
	}
}

package log;

import java.io.IOException;
import java.util.logging.FileHandler;
import java.util.logging.LogManager;
import java.util.logging.Logger;
import java.util.logging.SimpleFormatter;

public class EventLogger {
	FileHandler filehandler;
	LogManager logmanager;
	Logger logger;

	public EventLogger(String fileName){
		try {
			logmanager = LogManager.getLogManager();
			logger = logmanager.getLogger(Logger.GLOBAL_LOGGER_NAME);
			filehandler = new FileHandler(fileName);
			filehandler.setFormatter(new SimpleFormatter());
			logger.addHandler(filehandler);
		}
		catch (IOException e){
			e.printStackTrace();
		}
	}
	
	public void log(String logMessage) {
		logger.info(logMessage);
	}
}

package log;

public class LoggerTester {

	public static void main(String[] args) {
		EventLogger logger = new EventLogger("log.txt");
		logger.log("test");
	}
}

package song;

import java.util.Scanner;

import exceptions.EmailFormatException;

public class ElementarySchoolSong extends TeenageSong{

	protected String parentemail;
	protected String parentphone;

	public ElementarySchoolSong(SongKind kind) {
		super(kind);
	}

	public void getUserInput(Scanner input) {
		setSongID(input);
		setSongName(input);
		setSongEmailwithYN(input);
		setParentEmailwithYN(input);
		setSongPhone(input);
	}
	public void setParentEmailwithYN(Scanner input) {
		char answer = 'x';
		while (answer != 'y' && answer != 'Y' && answer != 'n' &&answer != 'N')
		{
			System.out.print("Do you have a parent's email address? (Y/N)");
			answer = input.next().charAt(0);
			try {
				if(answer == 'y' || answer =='Y') {
					setSongEmail(input);
					break;
				}
				else if(answer == 'n' || answer =='N') {
					this.setEmail("");
					break;
				}
				else {
				}
			}
			catch(EmailFormatException e) {
				System.out.println("Incorrect Email Format, put the e-mail address that contains @");
			}
		}
	}

	public void printInfo() {
		String skind = getKindString();
		System.out.println("kind : "+skind+" name : " + name + "id : " + id + "email : " + email + "phone : " + phone + "parent's email :" + email + "parent's phone : " + phone);
	}

}

package song;

import java.util.Scanner;

public class HighSchoolSong extends TeenageSong{
	
	public HighSchoolSong(SongKind kind) {
		super(kind);
	}
	
	public void getUserInput(Scanner input) {
		setSongID(input);
		setSongName(input);
		setSongEmailwithYN(input);
		setSongPhone(input);
	}
}

package song;

import java.io.Serializable;
import java.util.Scanner;

import exceptions.EmailFormatException;

public abstract class Song implements SongInput, Serializable{
	/**
	 * 
	 */
	private static final long serialVersionUID = -8574706114587752217L;
	protected SongKind kind = SongKind.University;
	protected String name;
	protected int id;
	protected String email;
	protected String phone;

	public Song() {
	}
	public Song(SongKind kind) {
		this.kind = kind;
	}
	public Song(String name, int id) {
		this.name = name;
		this.id = id;
	}

	public Song(String name, int id, String email, String phone) {
		this.name = name;
		this.id = id;
		this.email = email;
		this.phone = phone;
	}
	public Song(SongKind kind, String name, int id, String email, String phone) {
		this.kind = kind;
		this.name = name;
		this.id = id;
		this.email = email;
		this.phone = phone;
	}
	public SongKind getKind() {
		return kind;
	}
	public void setKind(SongKind kind) {
		this.kind = kind;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public int getId() {
		return id;
	}
	public void setId(int id) {
		this.id = id;
	}
	public String getEmail() {
		return email;
	}
	public void setEmail(String email) throws EmailFormatException {
		if(!email.contains("@") && !email.equals("")) {
			throw new EmailFormatException();
		}
		this.email = email;
	}
	public String getPhone() {
		return phone;
	}
	public void setPhone(String phone) {
		this.phone = phone;
	}

	public abstract void printInfo();

	public void setSongID(Scanner input) {
		System.out.print("song ID:");
		int id = input.nextInt();
		this.setId(id);
	}
	public void setSongName(Scanner input) {
		System.out.print("song name:");
		String name = input.next();
		this.setName(name);
	}
	public void setSongEmail(Scanner input) {
		String email = "";
		while (!email.contains("@")) {
			System.out.print("Email address:");
			email = input.next();
			try {
				this.setEmail(email);
			} catch (EmailFormatException e) {
				System.out.println("Incorrect Email Format, put the e-mail address that contains @");
			}
		}
	}
	public void setSongPhone(Scanner input) {
		System.out.print("Phone number:");
		String phone = input.next();
		this.setPhone(phone);
	}
	public String getKindString() {
		String skind = "none";
		switch(this.kind) {
		case University :
			skind = "Univ.";
			break;
		case HighSchool : 
			skind = "High.";
			break;
		case MiddleSchool :
			skind = "Middle.";
			break;
		case ElementarySchool :
			skind = "Elementary.";
			break;
		default:		
		}
		return skind;
	}
}

package song;

import java.util.Scanner;

import exceptions.EmailFormatException;

public interface SongInput {

	public int getId();
	public void setId(int id);
	public void setName(String name);
	public void setEmail(String email) throws EmailFormatException;
	public void setPhone(String phone);
	public void getUserInput(Scanner input);
	public void printInfo();
	public void setSongID(Scanner input);
	public void setSongName(Scanner input);
	public void setSongEmail(Scanner input);
	public void setSongPhone(Scanner input);
}


package song;

public enum SongKind {
	University,
	HighSchool,
	MiddleSchool,
	ElementarySchool,
}


package song;

import java.util.Scanner;

import exceptions.EmailFormatException;

public abstract class TeenageSong extends Song {

	public TeenageSong(SongKind kind) {
		super(kind);
	}

	@Override
	public abstract void getUserInput(Scanner input);

	@Override
	public void printInfo() {
		String skind = getKindString();
		System.out.println("kind : "+skind+" name : " + name + "id : " + id + "email : " + email + "phone : " + phone);
	}

	public void setSongEmailwithYN(Scanner input) {
		char answer = 'x';
		while (answer != 'y' && answer != 'Y' && answer != 'n' &&answer != 'N')
		{
			System.out.print("Do you have an email address? (Y/N)");
			answer = input.next().charAt(0);
			try {
			if(answer == 'y' || answer =='Y') {
				System.out.print("Email address:");
				String email = input.next();
				this.setEmail(email);
				break;
			}
			else if(answer == 'n' || answer =='N') {
				this.setEmail("");
				break;
			}
			else {
			}
			}
			catch(EmailFormatException e) {
				System.out.println("Incorrect Email Format, put the e-mail address that contains @");
			}
		}
	}
}

package song;

import java.util.Scanner;

public class UniversitySong extends Song{
	
	public UniversitySong(SongKind kind) {
		super(kind);
	}
	
	public void getUserInput(Scanner input) {
		setSongID(input);
		setSongName(input);
		setSongEmail(input);
		setSongPhone(input);
	}
	
	public void printInfo() {
		String skind = getKindString();
		System.out.println("kind : "+skind+" name : " + name + "id : " + id + "email : " + email + "phone : " + phone);
	}
}
